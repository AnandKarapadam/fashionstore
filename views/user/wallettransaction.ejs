<%- include("../partials/user/header.ejs") %>
<%- include("../partials/user/navbar.ejs") %>


<div class="row mt-5 pt-5">
        <div class="col-md-3 mt-5 d-none d-lg-block">
    <div class="sidebar-content ms-5 w-100" style="position: sticky;top: 150px;">
        <div class="bg-dark rounded-3 mb-4">
            <h6 class="text-white d-flex align-items-center py-3 ps-2 text-truncate"><i class="bi bi-person-circle fs-4 me-2"></i>Hello Anand KV</h6>
        </div>
        <ul class="nav flex-column ">
          <li class="nav-item"><a class="nav-link text-dark border" href="/profile"><i class="bi bi-person-circle me-2"></i> Profile</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/orders"><i class="bi bi-inboxes-fill me-2"></i> Orders</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/profile/wallet"><i class="bi bi-wallet me-2"></i> Wallet</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/address"><i class="bi bi-geo me-2"></i> Address</a></li>
           <li class="nav-item"><a class="nav-link text-dark border" href="/profile/refer&earn"><i class="bi bi-gift me-2"></i> Reffer & Earn</a></li>
          <li class="nav-item"><a class="nav-link text-dark border text-truncate" href="/delete-account" onclick="confirmDeleteEvent(event)"><i class="bi bi-trash2-fill me-2" ></i> Delete Account</a></li> 
          <li class="nav-item"><a class="nav-link text-dark border" href="/logout"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
        </ul>
        <form action="/delete-account" method="post" style="display: none;" id="deleteAccountForm" ></form>
      </div>
        </div>
        <div class="col-md-9 mb-5 mt-3 mx-auto">
            <div id="mainContent" class="main-content container">
    <div class="card shadow rounded-4 mx-auto p-4" style="max-width: 600px;">
      <h4 class="card-title text-center mb-4 fw-bold">MY WALLET</h4>
      <% if(transactions.length>0){%>
        <% transactions.forEach((transaction)=>{ %>
      <div class="border border-secondary bg-light d-flex rounded-2 py-1 ps-3 pe-3 justify-content-between align-items-center mb-3">
        <div class=" d-flex flex-column align-items-start justify-content-start">
           <% if(transaction.type==="CREDIT"){ %> 
          <p class="mb-0 fw-semibold">Added Money</p>
          <%} else{%>
            <p class="mb-0 fw-semibold">Deducted Money</p>
            <%}%>
          <p class="mb-0" style="font-size: 12px;">Wallet</p>
          <p class="mb-0 text-muted" style="font-size: 12px;" ><%= new Date(transaction.date).toLocaleString("en-IN", { day: "2-digit", month: "short", year: "numeric", hour: "2-digit", minute: "2-digit", timeZone: "Asia/Kolkata" }) %></p>
        </div>
        <div class="d-flex align-items-center justify-content-center">
            <% if(transaction.type==="CREDIT") {%>
          <p class="my-auto text-success fw-bold">+₹<%= transaction.amount %></p>
          <%}else {%>
             <p class="my-auto text-danger fw-bold">-₹<%= transaction.amount %></p>
            <%}%>
        </div>
      </div>
      <%})%>
      <div class="container mt-3">
              <nav aria-label="Page navigation">
                  <ul class="pagination pagination-sm justify-content-center mb-4" >
                      
                    <% const maxVisiblePages=3; let startPage=Math.max(1, currentPage - 1); let endPage=startPage +
                          maxVisiblePages - 1; if (endPage> totalPages) {
                          endPage = totalPages;
                          startPage = Math.max(1, endPage - maxVisiblePages + 1);
                          }
                          %>

                          <!-- Previous Button -->
                          <li class="page-item <%= currentPage == 1 ? ' disabled' : '' %>">
                                <a class="page-link"
                                    href="?page=<%= currentPage - 1 %>">&laquo;</a>
                    </li>

                    <!-- Page Numbers -->
                    <% for (let i=startPage; i <=endPage; i++) { %>
                        <li class="page-item <%= i == currentPage ? 'active' : '' %>">
                            <a class="page-link" href="?page=<%= i %>">
                                <%= i %>
                            </a>
                        </li>
                        <% } %>

                            <!-- Next Button -->
                            <li class="page-item <%= currentPage == totalPages ? 'disabled' : '' %>">
                                <a class="page-link"
                                    href="?page=<%= currentPage + 1 %>">&raquo;</a>
                            </li>

            </ul>
    </nav>
    </div>
      <%}else{%>

        <div class="d-flex text-muted align-items-center justify-content-center bg-light" style="height: 150px;">
        <p>No Previous Transactions!.</p>
         </div>
      

        <%}%>        
    </div>
    </div>
    </div>
    </div>


<%- include("../partials/user/footer.ejs") %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

     
    <script>
      function confirmDeleteEvent(e){
        e.preventDefault();

        Swal.fire({
          icon:"Warning",
          text:"This will permentaly delete your account!",
          title:"Are you sure?",
          showCancelButton:true,
          confirmButtonText:"Yes,delete it",
          cancelButtonText:"Cancel"
        }).then((result)=>{
          if(result.isConfirmed){
            document.getElementById("deleteAccountForm").submit()
          }
        })
      }
    </script>