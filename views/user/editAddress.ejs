<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <title>Document</title>
  <style>
    body {
      overflow-x: hidden;
    }

    .navbar .dropdown:hover .dropdown-menu {
      display: block;
    }

    .navbar .dropdown-toggle::after {
      display: inline-block;
      margin-left: 0.3em;
      vertical-align: middle;
      transition: transform 0.3s ease;
      content: "";
      border-top: 0.4em solid;
      border-right: 0.4em solid transparent;
      border-left: 0.4em solid transparent;
    }

    .navbar .dropdown:hover .dropdown-toggle::after {
      transform: rotate(180deg);
    }

    .nav-link {
      font-weight: 500;
      font-size: 17px;
      color: black;
    }

    .nav-icon {
      font-size: 23px;
      font-weight: 700;
      color: black;
    }

    .main-nav {
      border-bottom: 2px solid rgb(63, 61, 61);
      border-color: #ccc;
    }

    .navbar-brand {
      font-size: 40px;
      font-family: 'Times New Roman', Times, serif;
      color: rgb(74, 74, 74);
    }

    .nav-item:hover {
      background-color: gainsboro;
    }

    .label {
      font-size: 14px;
    }
  </style>
</head>

<body>
  <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-white px-3 mb-4">
    <a class="navbar-brand" href="/">RORITO</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <!-- Push everything to the right -->
      <ul class="navbar-nav ms-auto gap-lg-5 mb-2 mb-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/all-products">All products</a>
        </li>
        <% if(typeof user !=="undefined" ) {%>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              <%= user.name.split(' ')[0] %>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="/profile">Profile</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="/logout">Logout</a></li>
            </ul>
          </li>
          <% } %>
          <li class="nav-item d-lg-flex gap-5 align-items-center ">
            <a class="nav-icon" href="/cart"><i class="bi bi-cart4"></i></a>
            <a href="/wishlist" class="nav-icon"><i class="bi bi-handbag"></i></a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <form action="/all-products" method="get" class="d-flex ms-lg-3 mt-2 mt-lg-0" role="search">
              
              <input class="form-control border border-1 border-dark me-2 form-control-sm rounded-4" name="search" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-dark btn-sm rounded-4 " type="submit">Search</button>
              <a href="/" class="btn btn-dark rounded-5 btn-sm ms-1"><i class="bi bi-x-circle"></i></a>
                        
            </form>
          </li>
        </ul>
      </div>
    </nav>

    <div class="row mt-5 pt-5">
        <div class="col-md-3 mt-5 d-none d-lg-block">
    <div class="sidebar-content ms-5 w-100">
        <div class="bg-dark rounded-3 mb-4">
            <h6 class="text-white d-flex align-items-center py-3 ps-2 text-truncate"><i class="bi bi-person-circle fs-4 me-2"></i>Hello Anand KV</h6>
        </div>
        <ul class="nav flex-column ">
          <li class="nav-item"><a class="nav-link text-dark border" href="/profile"><i class="bi bi-person-circle me-2"></i> Profile</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/orders"><i class="bi bi-inboxes-fill me-2"></i> Orders</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/wallet"><i class="bi bi-wallet me-2"></i> Wallet</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/address"><i class="bi bi-geo me-2"></i> Address</a></li>
          <li class="nav-item"><a class="nav-link text-dark border text-truncate" href="/delete-account"><i class="bi bi-trash2-fill me-2"></i> Delete Account</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/logout"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
        </ul>
      </div>
        </div>
        <div class="col-md-9 mt-3 mb-5 mx-auto">
            <div id="mainContent" class="main-content container">
    <div class="card shadow rounded-4 mx-auto p-4" style="max-width: 600px;">
      <h4 class="card-title text-center mb-4 fw-bold">EDIT ADDRESS</h4>
    <form id="addressForm" action="/edit-address/<%= address._id %>" method="post">
      <div class="row mb-2">
        <div class="col-md-6">
            <label for="name" class="fw-bold label">Name</label>
            <input type="text" name="name" id="name" value="<%= address.name%>" class="form-control bg-light form-control-sm" placeholder="Enter name">
            <div class="text-danger small" id="nameError"></div>
        </div>
        <div class="col-md-6">
            <label for="phone" class="fw-bold label">Mobile Number</label>
            <input type="text" name="phone" id="phone" class="form-control bg-light form-control-sm" value="<%= address.phone %>" placeholder="Enter Phone">
            <div class="text-danger small" id="phoneError"></div>
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6">
            <label for="pin" class="fw-bold label">PIN Code</label>
            <input type="text" name="pincode" id="pin" class="form-control bg-light form-control-sm" value="<%= address.pincode %>" placeholder="Enter PIN code">
            <div class="text-danger small" id="pinError"></div>
        </div>
        <div class="col-md-6">
            <label for="locality" class="fw-bold label">Locality</label>
            <input type="text" name="locality" id="locality" class="form-control bg-light form-control-sm" value="<%= address.locality %>" placeholder="Your Locality">
            <div class="text-danger small" id="localityError"></div>
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-md-12 d-flex flex-column">
            <label for="address" class="fw-bold label">Address</label>
            <textarea name="address" name="address" id="address" rows="3" placeholder="Your address" class="form-control bg-light"><%= address.address %></textarea>
            <div class="text-danger small" id="addressError"></div>
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6">
            <label for="city" class="fw-bold label">City/Dist/Town</label>
            <input type="text" id="city" name="city" class="form-control bg-light form-control-sm" value="<%= address.city %>" placeholder="Enter city/dist/town">
            <div class="text-danger small" id="cityError"></div>
        </div>
        <div class="col-md-6">
            <label for="state" class="fw-bold label">State</label>
            <select name="state" id="state"  class="form-select form-select-sm bg-light">
              <option disabled <%= !address.state ? ' selected' : '' %>>--- Select State ---</option>

                <option value="Andhra Pradesh" <%=address.state==='Andhra Pradesh' ? 'selected' : '' %>>Andhra Pradesh
                </option>
                <option value="Arunachal Pradesh" <%=address.state==='Arunachal Pradesh' ? 'selected' : '' %>>Arunachal
                  Pradesh</option>
                <option value="Assam" <%=address.state==='Assam' ? 'selected' : '' %>>Assam</option>
                <option value="Bihar" <%=address.state==='Bihar' ? 'selected' : '' %>>Bihar</option>
                <option value="Chhattisgarh" <%=address.state==='Chhattisgarh' ? 'selected' : '' %>>Chhattisgarh
                </option>
                <option value="Goa" <%=address.state==='Goa' ? 'selected' : '' %>>Goa</option>
                <option value="Gujarat" <%=address.state==='Gujarat' ? 'selected' : '' %>>Gujarat</option>
                <option value="Haryana" <%=address.state==='Haryana' ? 'selected' : '' %>>Haryana</option>
                <option value="Himachal Pradesh" <%=address.state==='Himachal Pradesh' ? 'selected' : '' %>>Himachal
                  Pradesh</option>
                <option value="Jharkhand" <%=address.state==='Jharkhand' ? 'selected' : '' %>>Jharkhand</option>
                <option value="Karnataka" <%=address.state==='Karnataka' ? 'selected' : '' %>>Karnataka</option>
                <option value="Kerala" <%=address.state==='Kerala' ? 'selected' : '' %>>Kerala</option>
                <option value="Madhya Pradesh" <%=address.state==='Madhya Pradesh' ? 'selected' : '' %>>Madhya Pradesh
                </option>
                <option value="Maharashtra" <%=address.state==='Maharashtra' ? 'selected' : '' %>>Maharashtra</option>
                <option value="Manipur" <%=address.state==='Manipur' ? 'selected' : '' %>>Manipur</option>
                <option value="Meghalaya" <%=address.state==='Meghalaya' ? 'selected' : '' %>>Meghalaya</option>
                <option value="Mizoram" <%=address.state==='Mizoram' ? 'selected' : '' %>>Mizoram</option>
                <option value="Nagaland" <%=address.state==='Nagaland' ? 'selected' : '' %>>Nagaland</option>
                <option value="Odisha" <%=address.state==='Odisha' ? 'selected' : '' %>>Odisha</option>
                <option value="Punjab" <%=address.state==='Punjab' ? 'selected' : '' %>>Punjab</option>
                <option value="Rajasthan" <%=address.state==='Rajasthan' ? 'selected' : '' %>>Rajasthan</option>
                <option value="Sikkim" <%=address.state==='Sikkim' ? 'selected' : '' %>>Sikkim</option>
                <option value="Tamil Nadu" <%=address.state==='Tamil Nadu' ? 'selected' : '' %>>Tamil Nadu</option>
                <option value="Telangana" <%=address.state==='Telangana' ? 'selected' : '' %>>Telangana</option>
                <option value="Tripura" <%=address.state==='Tripura' ? 'selected' : '' %>>Tripura</option>
                <option value="Uttar Pradesh" <%=address.state==='Uttar Pradesh' ? 'selected' : '' %>>Uttar Pradesh
                </option>
                <option value="Uttarakhand" <%=address.state==='Uttarakhand' ? 'selected' : '' %>>Uttarakhand</option>
                <option value="West Bengal" <%=address.state==='West Bengal' ? 'selected' : '' %>>West Bengal</option>
                <option value="Andaman and Nicobar Islands" <%=address.state==='Andaman and Nicobar Islands'
                  ? 'selected' : '' %>>Andaman and Nicobar Islands</option>
                <option value="Chandigarh" <%=address.state==='Chandigarh' ? 'selected' : '' %>>Chandigarh</option>
                <option value="Dadra and Nagar Haveli and Daman and Diu"
                  <%=address.state==='Dadra and Nagar Haveli and Daman and Diu' ? 'selected' : '' %>>Dadra and Nagar
                  Haveli and Daman and Diu</option>
                <option value="Delhi" <%=address.state==='Delhi' ? 'selected' : '' %>>Delhi</option>
                <option value="Jammu and Kashmir" <%=address.state==='Jammu and Kashmir' ? 'selected' : '' %>>Jammu and
                  Kashmir</option>
                <option value="Ladakh" <%=address.state==='Ladakh' ? 'selected' : '' %>>Ladakh</option>
                <option value="Lakshadweep" <%=address.state==='Lakshadweep' ? 'selected' : '' %>>Lakshadweep</option>
                <option value="Puducherry" <%=address.state==='Puducherry' ? 'selected' : '' %>>Puducherry</option>
                </select>
                <div class="text-danger small" id="stateError"></div>
    </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-6">
        <label for="landmark" class="fw-bold label">Landmark</label>
        <input type="text" id="landmark" name="landMark" value="<%= address.landMark %>" class="form-control bg-light form-control-sm" placeholder="Enter landmark">
        <div class="text-danger small" id="landmarkError"></div>
      </div>
      <div class="col-md-6">
        <label for="alt-number" class="fw-bold label">Alternative Mobile Number</label>
        <input type="text" id="alt-number" name="altPhone" value="<%= address.altPhone %>" class="form-control bg-light form-control-sm" placeholder="Your Locality">
        <div class="text-danger small" id="altPhoneError"></div>
      </div>
    </div>

    <div class="row d-flex flex-row mt-2 mb-2">
      <div class="col-sm-6">
        <label for="home" class="fw-bold label">Home</label>
        <input type="radio" name="addressType" id="home" class="margin-right" value="home"  <%= address.addressType === 'home' ? 'checked' : '' %>>
        <label for="work" class="fw-bold label">Work</label>
        <input type="radio" name="addressType" id="work" value="work"  <%= address.addressType === 'work' ? 'checked' : '' %>>
        <div class="text-danger small" id="addressTypeError"></div>
      </div>
      <div class="col-sm-6 text-end">
        <button type="submit" class="btn btn-dark btn-sm">Save</button>
        <a href="/address" class="btn btn-outline-dark btn-sm">Cancel</a>
      </div>
    </div>
    </form>
    </div>
    </div>
    </div>
    </div>
    <%- include("../partials/user/footer.ejs") %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <% if( typeof message !== "undefined" ){ %>

        <script>
          Swal.fire({
            icon:"error",
            title:"error occured",
            text:"<%= message||'Internal error!, cannot edit address!'%>",
            timer:2000,
            showConfirmButton:false
          })
        </script>
      <% } %>
    
    <script>

      document.getElementById("addressForm").addEventListener("submit",(e)=>{
        let hasError = false;

        const fields = ['name','phone','pin','locality','adderss','city','state','landmark','alt-number','addressType'];

        fields.forEach((id)=>{
          const errorDiv =  document.getElementById(id+'Error')||document.getElementById("altPhoneError")||document.getElementById("addressTypeError");
          if(errorDiv){
            errorDiv.innerText = "";
          }
        })

         const name = document.getElementById('name').value.trim();
         const phone = document.getElementById('phone').value.trim();
         const pin = document.getElementById('pin').value.trim();
         const locality = document.getElementById('locality').value.trim();
         const address = document.getElementById('address').value.trim();
         const city = document.getElementById('city').value.trim();
         const state = document.getElementById('state').value;
         const landmark = document.getElementById('landmark').value.trim();
         const altPhone = document.getElementById('alt-number').value.trim();
         const addressTypeWork = document.getElementById('work').checked;
         const addressTypeHome = document.getElementById('home').checked;

         const phoneRegex = /^\d{10}$/;
         const pinRegex = /^\d{6}$/;

         if(name===''){
          document.getElementById("nameError").innerText = "Name is required";
          hasError = true;
         }
         if(!phoneRegex.test(phone)){
          document.getElementById("phoneError").innerText = "Phone must be 10 numbers";
          hasError = true;
         }
         if(!pinRegex.test(pin)){
          document.getElementById("pinError").innerText = "PIN must be 6 digits";
          hasError = true;
         }
         if(locality === ""){
          document.getElementById("localityError").innerText = "Locality is required";
          hasError = true;
         }

         if(address === ""){
          document.getElementById("addressError").innerText = "Adderss is required";
          hasError = true;
         }

         if(city === ""){
          document.getElementById("cityError").innerText = "City is required";
          hasError = true;
         }

         if(landmark === ""){
          document.getElementById("landmarkError").innerText = "Landmark is required";
          hasError = true
         }
         

         if(!state){
          document.getElementById("stateError").innerText = "State is required";
          hasError = true;
         }

         if(altPhone === ""){
          document.getElementById("altPhoneError").innerText = "Alternate Number is required."
          hasError = true;
         }
          else if(altPhone !== ""){
          if(!phoneRegex.test(altPhone)){
            document.getElementById("altPhoneError").innerText = "Alternate number must be 10 digits";
            hasError =  true;
          }else if(altPhone === phone){
            document.getElementById("altPhoneError").innerText = "Alternate number must be different from phone";
            hasError = true;
          }
         }

         if(!addressTypeHome && !addressTypeWork){
          document.getElementById("addressTypeError").innerHTML = "Please select home/work";
          hasError = true;
         }

         if (hasError){
          e.preventDefault();   
         }


      })
    </script>
</body>

</html>