<%- include("../partials/user/header.ejs") %>
<%- include("../partials/user/navbar.ejs") %>

    <div class="row mt-5 pt-5">
        <div class="col-md-3 mt-5 d-none d-lg-block">
    <div class="sidebar-content ms-5 w-100" style="position: sticky;top: 100px;">
        <div class="bg-dark rounded-3 mb-4">
            <h6 class="text-white d-flex align-items-center py-3 ps-2 text-truncate"><i class="bi bi-person-circle fs-4 me-2"></i>Hello Anand KV</h6>
        </div>
        <ul class="nav flex-column ">
          <li class="nav-item"><a class="nav-link text-dark border" href="/profile"><i class="bi bi-person-circle me-2"></i> Profile</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/orders"><i class="bi bi-inboxes-fill me-2"></i> Orders</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/wallet"><i class="bi bi-wallet me-2"></i> Wallet</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/address"><i class="bi bi-geo me-2"></i> Address</a></li>
          <li class="nav-item"><a class="nav-link text-dark border text-truncate" href="/delete-account"><i class="bi bi-trash2-fill me-2"></i> Delete Account</a></li>
          <li class="nav-item"><a class="nav-link text-dark border" href="/logout"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
        </ul>
      </div>
        </div>
        <div class="col-md-9 mb-5 mt-5 mx-auto">
            <div id="mainContent" class="main-content container">
              
    <div class="card shadow rounded-4 mx-auto p-4" style="max-width: 600px;">
      <h4 class="card-title text-center mb-4">MANAGE ADDRESS</h4>
      <div class="d-flex mb-2">
        <a href="/address/add" class="btn ms-auto btn-danger">Add new Address</a>
      </div>
      <% addresses.forEach((addr)=>{ %> 
         
      <div class="row bg-light border rounded-3 py-2 mb-2">
        <div class="  col-8">
          <p class="fw-bold mb-0"><%= addr.name %><br><span class="fw-normal"><%= addr.address %></span></p>
          <p class="fw-bold small mb-0">PIN: <span class="text-muted"><%= addr.pincode %></span></p>
          <p class="fw-bold small mb-0">Phone: <span class="text-muted"><%= addr.phone %></span></p>
          <p class="fw-bold small mb-0">Locality: <span class="text-muted"><%= addr.locality %></span></p>
        </div>
        <div class="col-4 text-end mb-2 d-flex flex-column align-items-end">
  <a href="/address/edit/<%= addr._id %>" class="btn border border-1 btn-sm p-1" style="background-color: white; width: 50px;">
    <i class="bi bi-pencil-fill"></i>
  </a>

  <a href="#" onclick="deleteAddress('<%= addr._id %>')" class="btn border border-1 btn-sm p-1" style="background-color: white;width: 50px;">
    <i class="bi bi-trash3-fill"></i>
  </a>

  <p class="text-muted text-capitalize small fw-bold"><%= addr.addressType %></p>
</div>

      </div>
      
      <% }) %>
      <div class="container mt-3">
              <nav aria-label="Page navigation">
                  <ul class="pagination justify-content-center mb-4" >
                      
                      <% const maxVisiblePages=3; let startPage=Math.max(1, currentPage - 1); let endPage=startPage +
                          maxVisiblePages - 1; if (endPage> totalPages) {
                          endPage = totalPages;
                          startPage = Math.max(1, endPage - maxVisiblePages + 1);
                          }
                          %>

                          <!-- Previous Button -->
                          <li class="page-item <%= currentPage == 1 ? ' disabled' : '' %>">
                                <a class="page-link"
                                    href="?page=<%= currentPage - 1 %>&search=<%= search %>">&laquo;</a>
                    </li>

                    <!-- Page Numbers -->
                    <% for (let i=startPage; i <=endPage; i++) { %>
                        <li class="page-item <%= i == currentPage ? 'active' : '' %>">
                            <a class="page-link" href="?page=<%= i %>&search=<%= search %>">
                                <%= i %>
                            </a>
                        </li>
                        <% } %>

                            <!-- Next Button -->
                            <li class="page-item <%= currentPage == totalPages ? 'disabled' : '' %>">
                                <a class="page-link"
                                    href="?page=<%= currentPage + 1 %>&search=<%= search %>">&raquo;</a>
                            </li>

            </ul>
    </nav>
    </div>
    </div>
    </div>
    </div>
    </div>
    <%- include("../partials/user/footer.ejs") %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      function deleteAddress(id){
        Swal.fire({
          title: "Are you sure?",
          text: "This will permanently delete the address.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Yes, delete it!"
        }).then(result=>{
          if(result.isConfirmed){
            fetch(`/address/delete/${id}`,{
              method:"Delete"
            }).then(res=>{
              if(res.ok){
                Swal.fire({
                title: "Deleted!",
                text: "The address has been deleted.",
                icon: "success",
                timer: 1500,
                showConfirmButton: false
              }).then(() => {
                window.location.reload();
                 })
              }else {
                Swal.fire({
                title: "Failed!",
                text: "Address cannot be deleted.",
                icon: "error",
                timer: 1500,
                showConfirmButton: false
              })
              }
            }).catch(err=>{
              Swal.fire("Error",err.message,"error");
            })
          }
        })
      }
    </script>
</body>

</html>