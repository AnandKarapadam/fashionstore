<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <title>Document</title>
  <style>
    body {
      overflow-x: hidden;
    }

    .navbar .dropdown:hover .dropdown-menu {
      display: block;
    }

    .navbar .dropdown-toggle::after {
      display: inline-block;
      margin-left: 0.3em;
      vertical-align: middle;
      transition: transform 0.3s ease;
      content: "";
      border-top: 0.4em solid;
      border-right: 0.4em solid transparent;
      border-left: 0.4em solid transparent;
    }

    .navbar .dropdown:hover .dropdown-toggle::after {
      transform: rotate(180deg);
    }

    .nav-link {
      font-weight: 500;
      font-size: 17px;
      color: black;
    }

    .nav-icon {
      font-size: 23px;
      font-weight: 700;
      color: black;
    }

    .main-nav {
      border-bottom: 2px solid rgb(63, 61, 61);
      border-color: #ccc;
    }

    .navbar-brand {
      font-size: 40px;
      font-family: 'Times New Roman', Times, serif;
      color: rgb(74, 74, 74);
    }

    .nav-item:hover {
      background-color: gainsboro;
    }

    .label {
      font-size: 14px;
    }

    .tracking-wrapper {
    position: relative;
    margin-left: 40px;
    padding-left: 30px;
  }

  .tracking-line {
    position: absolute;
    left: 0;
    top: 0;
    width: 3px;
    height: 100%;
    background-color: #ccc; /* grey base line */
    z-index: 1;
  }

  .tracking-line-progress {
    position: absolute;
    left: 0;
    top: 0;
    width: 3px;
    background-color: green; /* green overlay */
    z-index: 2;
  }
  

  .tracking-step {
    position: relative;
    margin-bottom: 40px;
  }

  .tracking-step:last-child {
    margin-bottom: 0;
  }

  .tracking-step .circle {
    position: absolute;
    left: -8.5px; /* centers the circle on 3px line */
    top: 0;
    width: 15px;
    height: 15px;
    background-color: white;
    border: 3px solid #ccc; /* grey by default */
    border-radius: 50%;
    z-index: 3;
    transition: background-color 0.3s, border-color 0.3s;
  }

  .tracking-step.completed .circle {
    border-color: green;
    background-color: green;
  }

  .tracking-step .label {
    margin-left: 15px;
    font-weight: 500;
  }
  </style>
</head>

<body>
  <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-white px-3 mb-4">
    <a class="navbar-brand" href="#">RORITO</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto gap-lg-5 mb-2 mb-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/all-products">All products</a>
        </li>
        <% if(typeof user !=="undefined" ) {%>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              <%= user.name.split(' ')[0] %>
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li><a class="dropdown-item" href="/profile">Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/logout">Logout</a></li>
          </ul>
        </li>
        <% } %>
        <li class="nav-item d-lg-flex gap-5 align-items-center ">
          <a class="nav-icon" href="/cart"><i class="bi bi-cart4"></i></a>
          <a href="/wishlist" class="nav-icon"><i class="bi bi-handbag"></i></a>
        </li>
        <li class="nav-item d-flex align-items-center">
          <form action="/all-products" method="get" class="d-flex ms-lg-3 mt-2 mt-lg-0" role="search">
            <input class="form-control border border-1 border-dark me-2 form-control-sm rounded-4" name="search"
              type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-dark btn-sm rounded-4" type="submit">Search</button>
            <a href="/" class="btn btn-dark rounded-5 btn-sm ms-1"><i class="bi bi-x-circle"></i></a>
          </form>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Updated Row -->
  <!-- Bootstrap CSS & Icons -->


<div class="container mt-5 pt-5">
  <div class="row g-4 align-items-start">
    <!-- Product Details (Left) -->
    <div class="col-md-8 d-flex justify-content-md-center">
      <!-- Image & Rating -->
      <div class="me-4 text-center">
        <img src="/uploads/re-image/<%= orderItem.product.productImage[0] %>" alt="Product Image" class="img-fluid mb-2" style="width: 120px; height: 160px; object-fit: contain;">
        <p class="mb-1"><small class="fw-bold">Rate This Product</small></p>
        <% if (orderItem.product.ratings && orderItem.product.ratings.average > 0) { %>
  <div class="text-warning mb-2">
    <% for (let i = 1; i <= 5; i++) { %>
      <% if (i <= orderItem.product.ratings.average) { %>
        <i class="bi bi-star-fill"></i>
      <% } else { %>
        <i class="bi bi-star"></i>
      <% } %>
    <% } %>
    <span class="text-muted">(<%= orderItem.product.ratings.count %> reviews)</span>
  </div>
<% } else { %>
  <p class="text-muted">No reviews yet</p>
<% } %>

        <a href="/product-details/<%= orderItem.product._id%>#review-section" class="btn btn-dark btn-sm fw-semibold">Add Review</a>
      </div>

      <!-- Product Text Details -->
      <div>
        <p class="mb-2 fw-bold"><%= orderItem.product.productName %></p>
        <p class="mb-2 small">Color:<%= orderItem.product.color %></p>
        <p class="small fw-semibold mb-2">Order ID: <span class="text-muted"><%= orderItem.orderId %></span></p>
        <p class="small fw-semibold">Item ID: <span class="text-muted"><%= orderItem.orderItemId %></span></p>
        <p class="fw-bold fs-5 mb-0 text-success">₹<%= orderItem.product.salePrice %></p>
        <p class="text-  small mt-4" style="font-size: 12px;">Status: <span class="text-muted fw-bold"><%= orderItem.status %></span></p>
      </div>
    </div>

    <!-- Tracking (Right) -->
    <div class="col-md-4">
      <div class="container ">
  <h5 class="fw-bold mb-4">Order Tracking</h5>

  <div class="tracking-wrapper">
    <!-- Grey base line -->
    <div class="tracking-line"></div>

    <!-- Green progress overlay -->
    <div class="tracking-line-progress" style="height: 75%;"></div> <!-- Change this -->

    <!-- Step 1 -->
    <div class="tracking-step">
      <div class="circle"></div>
      <div class="label">Order Placed</div>
    </div>

    <!-- Step 2 -->
    <div class="tracking-step">
      <div class="circle"></div>
      <div class="label">Shipped</div>
    </div>

    <!-- Step 3 -->
    <div class="tracking-step">
      <div class="circle"></div>
      <div class="label">Out for Delivery</div>
    </div>

    <!-- Step 4 -->
    <div class="tracking-step">
      <div class="circle"></div>
      <div class="label">Delivered</div>
    </div>xx
  </div>
</div>
    </div>
  </div>

  <div class="row mt-4">

    <div class="col-md-6 px-5 ">
      <div class="border border-1 h-100 rounded-4 p-3 shadow-sm">
      <p class="text-muted small">Product Details</p>
      <hr>
      <div class="d-flex justify-content-between">
        <p class="small">List Price</p>
        <p class="small fw-bold">₹<%= orderItem.product.regularPrice %></p>
      </div>
      <div class="d-flex justify-content-between">
        <p class="small">Selling Price</p>
        <p class="small fw-bold">₹<%= orderItem.product.salePrice %></p>
      </div>
      <div class="d-flex justify-content-between">
        <p class="small">Discount</p>
        <p class="small fw-bold">%<%= orderItem.product.productOffer %></p>
      </div>
      <div class="d-flex justify-content-between">
        <p class="small">Platform Fee</p>
        <p class="small fw-bold">₹11</p>
      </div>
      <hr>
      <div class="d-flex justify-content-between">
        <p class="small">Total Amount</p>
        <p class="small fw-bold text-success">₹<%= orderItem.product.salePrice-11 %></p>
      </div>
      </div>
    </div>
    <div class="col-md-6 px-5 mt-3 mt-md-0">
      <div class="border border-1 h-100 rounded-4 p-3 shadow-sm">
      <p class="text-muted small">Shipping Details</p>
      <hr>
        <p class="small"><%= orderItem.address.name %></p> 
        <p class="small"><%= orderItem.address.address %></p>
        <p class="small"><%= orderItem.address.city %></p>
        <p class="small">PIN:<%= orderItem.address.pincode %></p>
        <p class="small">Phone:<%= orderItem.address.phone %></p>    
      <hr>
      </div>
    </div>
  </div>
  <div class="text-center">
    <a href="/invoice/download/<%= orderItem.order_id %>/<%= orderItem.product._id %>" class="btn btn-outline-dark mt-4">
  <i class="bi bi-download me-1"></i> Download Invoice
</a>
  </div>
</div>
<div id="order-status" style="display:none;"><%= orderItem.status %></div>

  <%- include("../partials/user/footer.ejs") %>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const status = document.getElementById("order-status").textContent.trim();

  const stepIndexMap = {
    "Pending": 0,
    "Processing": 0, 
    "Shipped": 1,
    "Out for Delivery": 2,
    "Delivered": 3,
    "Cancelled": 0,
    "Return Request": 0,
    "Returned": 3
  };

  const statusProgressMap = {
    
    0: 10,
    1: 50,
    2: 75,
    3: 100,
    
  };

  const completedIndex = stepIndexMap[status] ?? -1;
  const percent = statusProgressMap[completedIndex] || 0;

   const progressLine = document.querySelector(".tracking-line-progress");
  progressLine.style.height = "0%"; // start collapsed
  progressLine.style.transition = "height 1.5s ease-in-out"; // animate change
  setTimeout(() => {
    progressLine.style.height = percent + "%"; // animate to desired height
  }, 100);

 

  document.querySelectorAll(".tracking-step").forEach((step, i) => {
    if (i <= completedIndex) {
      step.classList.add("completed");
    }
  });
});
</script>

</body>

</html>